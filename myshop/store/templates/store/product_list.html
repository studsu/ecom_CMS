{% extends 'store/base.html' %}
{% block title %}{% if category.meta_title %}{{ category.meta_title }}{% else %}Premium {{ category.name }} - {{ SITE_NAME }}{% endif %}{% endblock %}
{% block meta_description %}{% if category.meta_description %}{{ category.meta_description }}{% else %}Discover our curated collection of premium {{ category.name|lower }} for the discerning connoisseur. Quality guaranteed.{% endif %}{% endblock %}
{% block meta_keywords %}{% if category.meta_keywords %}{{ category.meta_keywords }}{% else %}premium {{ category.name|lower }}, luxury cigar accessories, {{ SITE_NAME }}{% endif %}{% endblock %}
{% load static %}

{% block banner %}
<!-- Modern Category Banner -->
<div class="relative w-full overflow-hidden bg-gradient-to-r from-gray-900 via-gray-800 to-black">
  <!-- Decorative Background Pattern -->
  <div class="absolute inset-0 opacity-10">
    <svg width="100%" height="100%" viewBox="0 0 100 20" preserveAspectRatio="none">
      <defs>
        <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
          <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#grid)" />
    </svg>
  </div>
  
  <!-- Category-specific Background -->
  {% if category.slug == 'cigar-cutter' %}
    <!-- Cigar Cutter Theme -->
    <div class="absolute inset-0 bg-gradient-to-r from-amber-900/20 to-yellow-800/20"></div>
    <div class="absolute top-10 right-10 opacity-5">
      <svg width="200" height="200" viewBox="0 0 24 24" fill="currentColor" class="text-yellow-500">
        <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
      </svg>
    </div>
  {% elif category.slug == 'lighter' %}
    <!-- Lighter Theme -->
    <div class="absolute inset-0 bg-gradient-to-r from-orange-900/20 to-red-800/20"></div>
    <div class="absolute top-10 right-10 opacity-5">
      <svg width="200" height="200" viewBox="0 0 24 24" fill="currentColor" class="text-orange-500">
        <path d="M13 6v5h1.17C15.37 9.71 16.95 9.23 18 8.5c-1.05.73-2.63 1.21-3.83 2.5H13v3c0 2.21-1.79 4-4 4s-4-1.79-4-4V9c0-2.21 1.79-4 4-4s4 1.79 4 4z"/>
      </svg>
    </div>
  {% else %}
    <!-- Default Theme -->
    <div class="absolute inset-0 bg-gradient-to-r from-blue-900/20 to-purple-800/20"></div>
  {% endif %}
  
  <!-- Banner Content -->
  <div class="relative z-20 max-w-7xl mx-auto px-4 py-16 md:py-24">
    <div class="text-center">
      <!-- Breadcrumb -->
      <nav class="mb-6">
        <ol class="flex justify-center items-center space-x-2 text-sm">
          <li><a href="{% url 'home' %}" class="text-gray-300 hover:text-yellow-400 transition-colors">Home</a></li>
          <li class="text-gray-500">/</li>
          <li class="text-yellow-400 font-medium">{{ category.name }}</li>
        </ol>
      </nav>
      
      <!-- Category Title -->
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">
        {% if category %}
          Premium 
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-500">
            {{ category.name }}
          </span>
        {% else %}
          Our Premium 
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-500">
            Collection
          </span>
        {% endif %}
      </h1>
      
      <!-- Category Description -->
      <p class="text-xl text-gray-200 mb-8 max-w-2xl mx-auto leading-relaxed">
        {% if category.slug == 'cigar-cutter' %}
          Precision-engineered cigar cutters designed for the perfect cut every time. From classic guillotine to luxury punch cutters.
        {% elif category.slug == 'lighter' %}
          Elegant lighters that combine functionality with luxury. From wind-resistant torches to collector's pieces.
        {% else %}
          Discover our handpicked collection of premium accessories crafted for the discerning connoisseur.
        {% endif %}
      </p>
      
      <!-- Stats -->
      <div class="flex justify-center items-center space-x-8 text-center">
        <div class="text-white">
          <div class="text-2xl font-bold text-yellow-400">{{ products.count }}+</div>
          <div class="text-sm text-gray-300">Products</div>
        </div>
        <div class="text-white">
          <div class="text-2xl font-bold text-yellow-400">Premium</div>
          <div class="text-sm text-gray-300">Quality</div>
        </div>
        <div class="text-white">
          <div class="text-2xl font-bold text-yellow-400">Fast</div>
          <div class="text-sm text-gray-300">Shipping</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Scroll Indicator -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
    <svg class="w-6 h-6 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
    </svg>
  </div>
</div>
{% endblock %}

{% block content %}
<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "Home",
    "item": "{{ request.scheme }}://{{ request.get_host }}"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "{% if category %}{{ category.name }}{% else %}All Products{% endif %}"
  }]
}
</script>

<!-- Main Products Section -->
<div class="bg-gray-50 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 py-12">
    
    <!-- Section Header with Filters -->
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 space-y-4 lg:space-y-0">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">
          {% if category %}{{ category.name }} Collection{% else %}All Products{% endif %}
        </h2>
        <p class="text-gray-600">{{ products.count }} product{{ products.count|pluralize }} found</p>
      </div>
      
      <!-- Filter Controls -->
      <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">
        <!-- Sort Dropdown -->
        <div class="relative">
          <select id="sortSelect" class="appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 text-gray-700 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent">
            <option value="">Sort by</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
            <option value="name">Name: A to Z</option>
            <option value="newest">Newest First</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>
        
        <!-- View Toggle -->
        <div class="flex bg-white border border-gray-300 rounded-lg overflow-hidden">
          <button id="gridView" class="px-3 py-2 bg-yellow-400 text-black transition-colors duration-300">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
            </svg>
          </button>
          <button id="listView" class="px-3 py-2 text-gray-600 hover:bg-gray-50 transition-colors duration-300">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div id="productsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
      {% for product in products %}
        <div class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden transform hover:-translate-y-2 animate-fade-in">
          <!-- Product Image -->
          <div class="relative overflow-hidden bg-gray-50 aspect-square">
            <a href="{% url 'product_detail' product.slug %}" class="block h-full">
              {% if product.image %}
                <img src="{{ product.image.url }}" 
                     alt="{{ product.name }}"
                     class="w-full h-full object-contain p-6 transition-transform duration-500 group-hover:scale-110 product-main-image"
                     loading="lazy">
                {% if product.gif %}
                  <img src="{{ product.gif.url }}" 
                       alt="{{ product.name }} animation"
                       class="w-full h-full object-contain p-6 transition-opacity duration-300 absolute top-0 left-0 opacity-0 group-hover:opacity-100 product-gif-image"
                       loading="lazy">
                {% endif %}
              {% else %}
                <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                  <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                </div>
              {% endif %}
            </a>
            
            <!-- Quick Actions Overlay -->
            {% if not product.gif %}
            <div class="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
              <a href="{% url 'product_detail' product.slug %}" 
                 class="bg-white text-gray-900 px-4 py-2 rounded-lg font-semibold transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 shadow-lg">
                Quick View
              </a>
            </div>
            {% endif %}
            
            <!-- Badges -->
            <div class="absolute top-4 left-4">
              <span class="bg-gradient-to-r from-yellow-400 to-amber-500 text-black text-xs font-bold px-2 py-1 rounded-full">
                Premium
              </span>
            </div>
          </div>

          <!-- Product Details -->
          <div class="p-6">
            <a href="{% url 'product_detail' product.slug %}" class="block group/link">
              <h3 class="font-bold text-lg text-gray-900 mb-2 line-clamp-2 group-hover/link:text-amber-600 transition-colors duration-300">
                {{ product.name }}
              </h3>
            </a>
            
            <p class="text-gray-600 text-sm mb-4 line-clamp-2">
              {{ product.description|truncatewords:15 }}
            </p>
            
            <!-- Rating (Simulated) -->
            <div class="flex items-center space-x-1 mb-4">
              {% for i in "12345" %}
                <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% endfor %}
              <span class="text-sm text-gray-500 ml-1">(5.0)</span>
            </div>
            
            <!-- Price -->
            <div class="flex items-center justify-between mb-6">
              <span class="text-2xl font-bold text-gray-900">â‚¹{{ product.price }}</span>
              <span class="text-sm text-green-600 font-medium">Free Shipping</span>
            </div>

            <!-- Action Buttons -->
            <div class="space-y-3">
              <form method="post" action="{% url 'add_to_cart' product.id %}?next={{ request.path }}">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" name="action" value="add"
                        class="w-full bg-gradient-to-r from-gray-900 to-gray-800 text-white py-3 px-6 rounded-xl hover:from-yellow-400 hover:to-amber-500 hover:text-black font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                  Add to Cart
                </button>
              </form>
              
              <form method="post" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" name="action" value="buy"
                        class="w-full border-2 border-gray-300 text-gray-700 py-3 px-6 rounded-xl hover:border-amber-500 hover:text-amber-600 font-medium transition-all duration-300">
                  Buy Now
                </button>
              </form>
            </div>
          </div>
        </div>
      {% empty %}
        <!-- Empty State -->
        <div class="col-span-full text-center py-16">
          <div class="max-w-md mx-auto">
            <svg class="w-24 h-24 text-gray-300 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
            </svg>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No products found</h3>
            <p class="text-gray-600 mb-6">We couldn't find any products matching your criteria.</p>
            <a href="{% url 'product_list' %}" 
               class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-yellow-400 to-amber-500 text-black font-semibold rounded-lg hover:from-yellow-500 hover:to-amber-600 transition-all duration-300">
              View All Products
            </a>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Load More Button (if pagination needed) -->
    {% if products.count > 12 %}
    <div class="text-center mt-12">
      <button class="inline-flex items-center px-8 py-4 bg-white border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:border-amber-500 hover:text-amber-600 transition-all duration-300">
        Load More Products
        <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
        </svg>
      </button>
    </div>
    {% endif %}
  </div>
</div>

<!-- Enhanced JavaScript for Interactions -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // View toggle functionality
  const gridView = document.getElementById('gridView');
  const listView = document.getElementById('listView');
  const container = document.getElementById('productsContainer');

  gridView?.addEventListener('click', function() {
    container.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8';
    gridView.classList.add('bg-yellow-400', 'text-black');
    gridView.classList.remove('text-gray-600');
    listView.classList.remove('bg-yellow-400', 'text-black');
    listView.classList.add('text-gray-600');
  });

  listView?.addEventListener('click', function() {
    container.className = 'grid grid-cols-1 gap-6';
    listView.classList.add('bg-yellow-400', 'text-black');
    listView.classList.remove('text-gray-600');
    gridView.classList.remove('bg-yellow-400', 'text-black');
    gridView.classList.add('text-gray-600');
  });

  // Sort functionality (basic)
  const sortSelect = document.getElementById('sortSelect');
  sortSelect?.addEventListener('change', function() {
    // This would typically trigger a page reload with sort parameters
    const sortValue = this.value;
    if (sortValue) {
      const url = new URL(window.location);
      url.searchParams.set('sort', sortValue);
      window.location.href = url.toString();
    }
  });

  // Animate cards on scroll
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver(function(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.animationDelay = Math.random() * 0.5 + 's';
        entry.target.classList.add('animate-slide-up');
      }
    });
  }, observerOptions);

  document.querySelectorAll('.group').forEach(card => {
    observer.observe(card);
  });

});
</script>
{% endblock %}
