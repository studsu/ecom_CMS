{% extends "base.html" %}

{% block title %}My Wishlist - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-rose-25 via-white to-champagne-25 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Elegant Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl lg:text-5xl font-serif font-bold bg-gradient-to-r from-primary-600 via-gold-500 to-rose-600 bg-clip-text text-transparent mb-4">
                My Jewelry Wishlist
            </h1>
            <p class="text-xl text-gray-600 font-elegant max-w-2xl mx-auto leading-relaxed">
                Your curated collection of desired treasures - each piece waiting to become part of your jewelry story
            </p>
        </div>

        {% if items %}
            <!-- Wishlist Items Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 mb-12">
                {% for item in items %}
                <div class="group bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl hover:shadow-3xl transition-all duration-500 overflow-hidden transform hover:scale-105 ring-1 ring-rose-100 hover:ring-primary-200">
                    <a href="{% url 'catalog:product_detail' item.product.slug %}" class="block">
                        <div class="aspect-w-1 aspect-h-1 bg-gradient-to-br from-rose-50 to-champagne-50 rounded-t-3xl overflow-hidden relative">
                            {% if item.product.image %}
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.title }}" class="w-full h-80 object-cover group-hover:scale-110 transition-transform duration-700">
                            {% else %}
                                <div class="w-full h-80 bg-gradient-to-br from-primary-100 via-white to-gold-100 flex items-center justify-center group-hover:scale-110 transition-transform duration-700 relative">
                                    <svg class="w-20 h-20 text-primary-600 animate-pulse" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M5 16L3 14l5.5-11h7L21 14l-2 2H5zm2.7-5h8.6l-1.5-3H8.2l-1.5 3zm1.8 3l2.5 2.5L14.5 14H7.5z"/>
                                    </svg>
                                    <div class="absolute inset-0 bg-gradient-to-br from-primary-600/10 to-gold-600/10 group-hover:from-primary-600/20 group-hover:to-gold-600/20 transition-all duration-500"></div>
                                </div>
                            {% endif %}

                            <!-- Added to Wishlist Date -->
                            <div class="absolute top-4 left-4">
                                <div class="bg-white/90 backdrop-blur-sm text-primary-600 px-3 py-1 rounded-full text-xs font-serif font-medium">
                                    Added {{ item.added_at|date:"M d" }}
                                </div>
                            </div>

                            <!-- Remove from Wishlist Button -->
                            <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <button onclick="removeFromWishlist({{ item.product.id }}, event)" class="bg-white/90 backdrop-blur-sm text-red-500 p-3 rounded-full hover:bg-white hover:text-red-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-110">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Availability Status -->
                            {% if not item.product.is_in_stock %}
                            <div class="absolute bottom-4 left-4">
                                <span class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-serif font-medium">Sold Out</span>
                            </div>
                            {% elif item.product.featured %}
                            <div class="absolute bottom-4 left-4">
                                <span class="bg-gradient-to-r from-gold-500 to-gold-600 text-white px-3 py-1 rounded-full text-xs font-serif font-medium">Signature</span>
                            </div>
                            {% endif %}
                        </div>
                    </a>

                    <div class="p-8">
                        <div class="mb-3">
                            <span class="text-sm text-primary-600 font-serif font-medium tracking-wider uppercase">{{ item.product.category.name }}</span>
                        </div>
                        <h3 class="text-xl font-serif font-semibold text-gray-900 mb-3 group-hover:text-primary-600 transition-colors duration-300 line-clamp-2">
                            <a href="{% url 'catalog:product_detail' item.product.slug %}">{{ item.product.title }}</a>
                        </h3>
                        <p class="text-gray-600 font-elegant mb-6 leading-relaxed line-clamp-2">
                            {{ item.product.short_description|default:item.product.description|truncatewords:12 }}
                        </p>

                        <!-- Price -->
                        <div class="mb-6">
                            {% if item.product.sale_price and item.product.sale_price < item.product.price %}
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl font-serif font-bold text-primary-600">{{ CURRENCY_SYMBOL }}{{ item.product.sale_price }}</span>
                                    <span class="text-lg text-gray-500 line-through font-elegant">{{ CURRENCY_SYMBOL }}{{ item.product.price }}</span>
                                </div>
                            {% else %}
                                <span class="text-2xl font-serif font-bold text-primary-600">{{ CURRENCY_SYMBOL }}{{ item.product.price }}</span>
                            {% endif %}
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-3">
                            {% if item.product.is_in_stock %}
                                <form method="post" action="{% url 'catalog:cart_add' item.product.id %}" class="flex-1">
                                    {% csrf_token %}
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit" class="w-full bg-gradient-to-r from-primary-500 via-primary-600 to-rose-600 text-white py-3 px-6 rounded-2xl font-serif font-semibold hover:from-primary-600 hover:via-primary-700 hover:to-rose-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                                        Add to Collection
                                    </button>
                                </form>
                            {% else %}
                                <button disabled class="flex-1 bg-gray-300 text-gray-500 py-3 px-6 rounded-2xl font-serif font-semibold cursor-not-allowed">
                                    Currently Unavailable
                                </button>
                            {% endif %}

                            <button onclick="removeFromWishlist({{ item.id }}, event)" class="bg-white border-2 border-rose-200 text-gray-600 px-4 py-3 rounded-2xl hover:bg-rose-50 hover:border-rose-300 hover:text-rose-600 transition-all duration-300 flex-shrink-0">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9zM4 5a2 2 0 012-2h8a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zM8 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v4a1 1 0 11-2 0V8z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Wishlist Actions -->
            <div class="text-center">
                <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 ring-1 ring-rose-100 max-w-2xl mx-auto">
                    <h3 class="text-2xl font-serif font-bold text-gray-900 mb-4">Share Your Wishlist</h3>
                    <p class="text-gray-600 font-elegant mb-6">
                        Let others know about your exquisite taste in jewelry or save your wishlist for future reference.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="shareWishlist()" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-8 py-3 rounded-2xl font-serif font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                            Share Wishlist
                        </button>
                        <button onclick="clearWishlist()" class="border-2 border-gray-300 text-gray-600 px-8 py-3 rounded-2xl font-serif font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all duration-300">
                            Clear All
                        </button>
                    </div>
                </div>
            </div>

        {% else %}
            <!-- Empty Wishlist State -->
            <div class="text-center py-20">
                <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-2xl p-16 ring-1 ring-rose-100 max-w-2xl mx-auto">
                    <div class="w-32 h-32 bg-gradient-to-br from-primary-100 via-rose-100 to-gold-100 rounded-full flex items-center justify-center mx-auto mb-8 shadow-xl">
                        <svg class="w-16 h-16 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-3xl font-serif font-bold text-gray-900 mb-4">Your Heart Desires</h3>
                    <p class="text-lg text-gray-600 font-elegant mb-8 leading-relaxed">
                        Your wishlist is waiting to be filled with exquisite jewelry pieces. Discover our collections and save the pieces that capture your heart.
                    </p>
                    <div class="space-y-4">
                        <a href="{% url 'catalog:product_list' %}" class="inline-block bg-gradient-to-r from-primary-500 via-primary-600 to-rose-600 text-white px-10 py-4 rounded-2xl font-serif font-semibold text-lg hover:from-primary-600 hover:via-primary-700 hover:to-rose-700 transition-all duration-300 transform hover:scale-105 shadow-xl hover:shadow-2xl">
                            Explore Our Collections
                        </a>
                        <div class="text-sm text-gray-500 font-elegant">
                            Browse diamonds, gold jewelry, and precious gems
                        </div>
                    </div>

                    <!-- How to Add to Wishlist -->
                    <div class="mt-12 p-6 bg-gradient-to-r from-primary-50 to-rose-50 rounded-2xl border border-primary-100">
                        <h4 class="text-lg font-serif font-semibold text-gray-900 mb-4">How to Build Your Wishlist</h4>
                        <div class="space-y-3 text-left">
                            <div class="flex items-center text-gray-700">
                                <svg class="w-5 h-5 text-primary-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="font-elegant text-sm">Browse our jewelry collections</span>
                            </div>
                            <div class="flex items-center text-gray-700">
                                <svg class="w-5 h-5 text-primary-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="font-elegant text-sm">Click the heart icon on pieces you love</span>
                            </div>
                            <div class="flex items-center text-gray-700">
                                <svg class="w-5 h-5 text-primary-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="font-elegant text-sm">Return here to view and purchase your favorites</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<style>
/* Floating animation for empty state icon */
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.animate-float {
    animation: float 4s ease-in-out infinite;
}

/* Line clamp utility */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Hover effects for wishlist cards */
.group:hover .aspect-w-1 {
    transform: scale(1.02);
}

/* Smooth transitions */
* {
    transition: all 0.3s ease;
}

/* Responsive grid adjustments */
@media (max-width: 768px) {
    .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3 {
        grid-template-columns: 1fr;
    }

    .flex.flex-col.sm\:flex-row {
        flex-direction: column;
    }
}
</style>

<script>
function removeFromWishlist(productId, event) {
    // Prevent the parent anchor link from being triggered
    event.preventDefault();
    event.stopPropagation();

    if (confirm('Are you sure you want to remove this beautiful piece from your wishlist?')) {
        fetch('{% url "wishlist:remove_from_wishlist" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_id: productId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Add elegant removal animation
                const card = event.target.closest('.group');
                card.style.transform = 'scale(0.8)';
                card.style.opacity = '0';
                setTimeout(() => {
                    card.remove();
                    // Check if wishlist is now empty
                    const remainingCards = document.querySelectorAll('.group').length;
                    if (remainingCards === 1) { // 1 because we haven't removed the DOM element yet
                        location.reload();
                    }
                }, 300);
            } else {
                alert('Unable to remove item from wishlist. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again later.');
        });
    }
}

function shareWishlist() {
    const url = window.location.href;
    const text = 'Check out my jewelry wishlist at {{ SITE_NAME }}!';

    if (navigator.share) {
        navigator.share({
            title: 'My Jewelry Wishlist',
            text: text,
            url: url
        });
    } else {
        // Fallback to copying URL to clipboard
        navigator.clipboard.writeText(url).then(() => {
            alert('Wishlist link copied to clipboard! Share it with friends and family.');
        }).catch(() => {
            alert('Unable to copy link. You can manually share this URL: ' + url);
        });
    }
}

function clearWishlist() {
    if (confirm('Are you sure you want to remove all items from your wishlist? This action cannot be undone.')) {
        fetch('{% url "wishlist:clear_wishlist" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Unable to clear wishlist. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again later.');
        });
    }
}

// Add elegant loading animations
document.addEventListener('DOMContentLoaded', function() {
    const wishlistCards = document.querySelectorAll('.group');

    wishlistCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';

        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Add floating animation to empty state icon
    const emptyIcon = document.querySelector('.w-32.h-32');
    if (emptyIcon) {
        emptyIcon.classList.add('animate-float');
    }
});

// Add CSRF token to all forms
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');

    if (csrfToken) {
        forms.forEach(form => {
            if (!form.querySelector('[name=csrfmiddlewaretoken]')) {
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'csrfmiddlewaretoken';
                hiddenInput.value = csrfToken.value;
                form.appendChild(hiddenInput);
            }
        });
    }
});
</script>

<!-- Add CSRF token for AJAX requests -->
{% csrf_token %}
{% endblock %}